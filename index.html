<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bookcase</title>
</head>
<body>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
<script src="https://cdn.bootcss.com/vue/2.6.10/vue.js"></script>
<script src="https://cdn.bootcss.com/element-ui/2.11.1/index.js"></script>
<link href="https://cdn.bootcss.com/element-ui/2.11.1/theme-chalk/index.css" rel="stylesheet">
<div id="bookcase">
    <el-tabs v-model="activeName">
        <el-tab-pane label="待读" name="Waiting">
            <books :status="'Waiting'" :books="books"/>
        </el-tab-pane>
        <el-tab-pane label="正读" name="Reading">
            <books :status="'Reading'" :books="books"/>
        </el-tab-pane>
        <el-tab-pane label="已读" name="Read">
            <books :status="'Read'" :books="books"/>
        </el-tab-pane>
    </el-tabs>
</div>
<script>
    'use strict'
    document.domain = "rainbowyang.moe" //for cross origin
    let books = []
    $.getJSON("bookinfo.json", (data) => data.forEach(book => books.push(book)))

    let vm = new Vue({
        el: '#bookcase',
        data: {
            activeName: 'Reading',
            books: books,
        },
        components: {
            "books": {
                props: ['status', 'books'],
                template: `
                    <el-collapse>
                        <div v-for="book in books" v-if="book.status==status">
                            <el-collapse-item>
                                <template slot="title">
                                    <el-tag>『{{book.title}}』</el-tag>
                                </template>
                                <div>
                                    <el-tag>作者</el-tag>
                                    <el-tag v-if="book.author" type="info">{{book.author}}</el-tag>
                                    <el-tag v-else type="info">Unknown</el-tag>
                                </div>
                                <div>
                                    <el-tag>进度</el-tag>
                                    <el-progress v-if="book.progress"
                                                 style="width: 350px;display:inline-block"
                                                 :percentage="book.progress"/>
                                    <el-progress v-else
                                                 style="width: 350px;display:inline-block"
                                                 :percentage="book.status=='Read'? 100 : 0"/>
                                </div>
                                <div v-if="book.URL">
                                    <el-tag>链接</el-tag>
                                    <el-link :href="book.URL" type="primary">{{book.URL}}</el-link>
                                </div>
                            </el-collapse-item>
                        </div>
                    </el-collapse>
                `
            }
        }
    })
</script>
</body>
</html>